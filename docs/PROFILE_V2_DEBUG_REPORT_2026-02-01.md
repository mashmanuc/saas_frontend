# Profile V2 Debug Report - 2026-02-01

## Виконані завдання

### 1. Діагностика прогрес-бару ✅
**Проблема:** Прогрес-бар не відображався у Profile V2  
**Причина:** Неправильна структура payload при збереженні профілю - використовувався `profile` замість `tutor_profile`  
**Рішення:** Виправлено `ProfileEditView.vue` для використання правильної структури:
```javascript
// Було:
{ user: {...}, profile: {...} }

// Стало:
{ user: {...}, tutor_profile: {...} } // для тьюторів
{ user: {...}, student_profile: {...} } // для студентів
```

**Результат:** Прогрес-бар тепер коректно відображає 60% заповненості профілю

### 2. Виправлення нормалізації ролей ✅
**Проблема:** `isTutor` getter не спрацьовував через регістр ролі (`'tutor'` vs `'TUTOR'`)  
**Рішення:** Додано case-insensitive перевірку в `profileStore.js`:
```javascript
const isTutorRole = (role) => typeof role === 'string' && role.trim().toUpperCase() === 'TUTOR'
const isStudentRole = (role) => typeof role === 'string' && role.trim().toUpperCase() === 'STUDENT'
```

### 3. Тестування збереження даних ✅
**Перевірено:**
- ✅ Ім'я та прізвище зберігаються
- ✅ Заголовок (headline) зберігається
- ✅ Біо (bio) зберігається
- ✅ Погодинна ставка (hourly_rate) зберігається
- ✅ Досвід (experience) зберігається
- ✅ Дані відображаються після перезавантаження сторінки

### 4. Перевірка відображення на маркетплейсі ✅
**Результат:** Профіль Cergio Lolop успішно відображається на маркетплейсі з:
- Аватаром
- Ціною: 6100 UAH/год (помилка в legacy - має бути 350)
- Мовою: uk

## Виявлені проблеми

### 1. Предмети не синхронізуються між Legacy та V2 ⚠️
**Опис:** Предмети, додані через legacy-інтерфейс, не відображаються у V2 та на маркетплейсі  
**Причина:** ProfileEditView V2 не має полів для предметів (subjects) та сертифікатів (certifications)  
**Вплив на прогрес:** -20% (subjects) + -10% (certifications) = максимум 60% замість 100%

**Рекомендація:** Додати поля subjects та certifications до ProfileEditView V2 у наступній ітерації

### 2. Контакти: 0 ⚠️
**Опис:** Лічильник контактів показує 0 для нового тьютора  
**Статус:** Потребує окремого дослідження - можливо, це коректна поведінка для нового профілю без активних студентів

### 3. Розбіжність цін ⚠️
**Опис:** На маркетплейсі відображається 6100 UAH/год замість 350 UAH/год  
**Причина:** Можлива помилка в legacy-коді або кешуванні даних  
**Статус:** Потребує перевірки legacy marketplace компонента

## Технічні зміни

### Файли змінені:
1. `src/modules/profileV2/services/profileStore.js`
   - Додано нормалізацію ролей (isTutorRole, isStudentRole)
   - Виправлено translate helper

2. `src/modules/profileV2/views/ProfileEditView.vue`
   - Виправлено структуру payload для збереження (tutor_profile/student_profile)

3. `docs/architecture/UI_CONTRACT_INTEGRATION_TZ.md`
   - Додано секцію "Політика доменних термінів та текстів"

## Метрики

### Прогрес-бар V2:
- **До виправлення:** 0% (не відображався)
- **Після виправлення:** 60% (коректно)
- **Максимально можливий:** 100% (потребує додавання subjects + certifications + avatar)

### Поточний розподіл балів (60%):
- bio: 20%
- headline: 15%
- experience: 10%
- hourly_rate: 15%
- subjects: 0% (не реалізовано у V2)
- certifications: 0% (не реалізовано у V2)
- avatar: 0% (є, але не враховується - потребує перевірки)

## Рекомендації для наступних етапів

1. **Додати поля subjects та certifications до ProfileEditView V2**
   - Створити компонент SubjectSelector
   - Інтегрувати з tutor_profile.subjects
   - Додати валідацію

2. **Дослідити проблему з контактами**
   - Перевірити API `/api/v1/tutors/me/relations/`
   - Перевірити логіку підрахунку контактів

3. **Виправити відображення ціни на маркетплейсі**
   - Перевірити legacy marketplace компонент
   - Очистити кеш, якщо потрібно

4. **Додати e2e тести для повного флоу**
   - Публікація → Видалення → Повторна публікація
   - Перевірка збереження всіх полів

## Висновок

✅ **Основна проблема вирішена:** Прогрес-бар тепер коректно відображається у Profile V2  
✅ **Дані зберігаються:** Всі базові поля профілю працюють коректно  
✅ **Профіль на маркетплейсі:** Відображається успішно  
⚠️ **Потребує доопрацювання:** Предмети, сертифікати, контакти

**Статус:** Profile V2 готовий до використання для базових сценаріїв редагування профілю
