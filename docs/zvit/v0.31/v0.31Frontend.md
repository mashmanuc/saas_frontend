# v0.31 Frontend ‚Äî –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–∏–π –∑–≤—ñ—Ç

**–í–µ—Ä—Å—ñ—è:** 0.31  
**–†–æ–ª—å:** Frontend (—ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ BE)  
**–î–∞—Ç–∞:** 17.12.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –¥–æ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó

---

## üìã SUMMARY

–£ v0.31 –Ω–∞ FE —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ Presence & Live Cursors –¥–ª—è Classroom (WS), follow-teacher (—Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è viewport –Ω–∞ –∫—É—Ä—Å–æ—Ä –≤–∏–∫–ª–∞–¥–∞—á–∞), Snapshot UI (save/restore –∑ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—î—é –≤–µ—Ä—Å—ñ—ó), Quota UX (–ø–∞–Ω–µ–ª—å used/quota + 80% warning + CTA –Ω–∞ upgrade), –∞ —Ç–∞–∫–æ–∂ telemetry –¥–ª—è upload/save (best-effort, –Ω–µ –±–ª–æ–∫—É—î UI).

---

## ‚úÖ WS Presence & Cursors (Classroom)

### URL
- `ws://{HOST}/ws/classroom/{class_id}/session/{session_id}/`

### Auth
- JWT **–ª–∏—à–µ —á–µ—Ä–µ–∑ headers**:
  - `Authorization: Bearer <token>`
  - –∞–±–æ —á–µ—Ä–µ–∑ `Sec-WebSocket-Protocol` (—è–∫ —É–∑–≥–æ–¥–∂–µ–Ω–æ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ)
- –¢–æ–∫–µ–Ω–∏ —É query string ‚Äî **–∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ**.

### RBAC
- –î–æ—Å—Ç—É–ø –¥–æ–∑–≤–æ–ª–µ–Ω–æ:
  - tutor (–≤–ª–∞—Å–Ω–∏–∫/–≤–µ–¥—É—á–∏–π —Å–µ—Å—ñ—ó), –∞–±–æ
  - user –∑ –∞–∫—Ç–∏–≤–Ω–∏–º `ClassroomMembership` —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–º—É `classrooms.Classroom`.

### Payload / Rate Limits
- Max payload: **2 KiB**
- `cursor.update`: **‚â§ 20/—Å–µ–∫** –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

### Close codes
- `4400` ‚Äî bad request (–Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–π payload/—Ç–∏–ø)
- `4401` ‚Äî unauthorized (–Ω–µ–º–∞/–Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–π JWT)
- `4403` ‚Äî forbidden (–Ω–µ–º–∞—î –ø—Ä–∞–≤)
- `4429` ‚Äî rate limited

### FE DoD (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
- Reconnect/backoff –ø—Ä–∏ abnormal close
- –ú–∞–ø—ñ–Ω–≥ close codes ‚Üí UX –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- –î–µ–¥—É–ø/—Ç—Ä–æ—Ç–ª—ñ–Ω–≥ cursor.update –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ (—â–æ–± –Ω–µ –ª–æ–≤–∏—Ç–∏ 4429)

### –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –Ω–∞ FE
- Live cursors overlay —É BoardCanvas (HTML overlay –Ω–∞–¥ canvas)
- Follow-teacher toggle: —É —Ä–µ–∂–∏–º—ñ follow, viewport —É—á–Ω—è —Ü–µ–Ω—Ç—Ä—É—î—Ç—å—Å—è –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö –∫—É—Ä—Å–æ—Ä–∞ teacher
- –ü—Ä–∏ —Ä—É—á–Ω—ñ–π –≤–∑–∞—î–º–æ–¥—ñ—ó —é–∑–µ—Ä–∞ (—Å–∫—Ä–æ–ª/–∑—É–º) follow —Ä–µ–∂–∏–º –º–æ–∂–Ω–∞ –≤–∏–º–∏–∫–∞—Ç–∏ –∑ UI (toggle)

---

## ‚úÖ Telemetry ingest

### Endpoint
- `POST /api/v1/logs/telemetry/`

### –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ
- `AllowAny` (–º–æ–∂–Ω–∞ —Å–ª–∞—Ç–∏ –±–µ–∑ auth)
- Throttle: **300/min**
- Payload limit: **32 KiB**
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ `Content-Encoding: gzip`
- –í—ñ–¥–ø–æ–≤—ñ–¥—å: `204 No Content` (best-effort)

### –§–æ—Ä–º–∞—Ç payload (JSON)

–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–æ:
- `event_type` (string)

–û–ø—Ü—ñ–π–Ω–æ:
- `version` (string)
- `session_id` (string)
- `payload` (object)

---

## üîó –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
- –î–µ—Ç–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç WS/HTTP —ñ error mapping: `docs/plan/v0.31/contrakt.md`

---

## ‚úÖ Upload & Save Telemetry (FE)

### Upload
- `upload_presign_failed`
- `upload_put_failed`

### Save
- `solo_save` / `solo_beacon_heartbeat` (—á–µ—Ä–µ–∑ —ñ—Å–Ω—É—é—á–∏–π telemetry –∫–ª—ñ—î–Ω—Ç)

---

## ‚úÖ Snapshot UI (FE)

- Create snapshot (autosave) + Restore snapshot (history)
- –ü—ñ—Å–ª—è save/restore –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–∞ `boardVersion` (—â–æ–± —É–Ω–∏–∫–∞—Ç–∏ —Ä–æ–∑—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–≤)

---

## ‚úÖ Quota / Upgrade UX (FE)

- Toast –Ω–∞ `403 quota_exceeded` –∑ CTA –Ω–∞ `/plans`
- –ü–∞–Ω–µ–ª—å –∫–≤–æ—Ç–∏ —É `RoomToolbar` (used / limit)
- Soft warning –ø—Ä–∏ >= 80% –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ)

---

*–°—Ç–∞—Ç—É—Å: FE-—á–∞—Å—Ç–∏–Ω–∞ v0.31 –≤–∏–∫–æ–Ω–∞–Ω–∞. –ó–∞–ª–∏—à–∏–ª–æ—Å—å –ª–∏—à–µ –ø—Ä–æ–≥–Ω–∞—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω—ñ –∑–±—ñ—Ä–∫–∏/–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∞ –∑–∞—Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏.*
