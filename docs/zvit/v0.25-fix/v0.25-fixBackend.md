# v0.25-FIX Backend ‚Äî Integration Layer Report

**–í–µ—Ä—Å—ñ—è:** 0.25-FIX  
**–†–æ–ª—å:** Backend Developer  
**–î–∞—Ç–∞:** 12.12.2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

---

## üìã SUMMARY

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–∏–π —à–∞—Ä –º—ñ–∂ –º–æ–¥—É–ª—è–º–∏ Marketplace, Booking —Ç–∞ Classroom. –°—Ç–≤–æ—Ä–µ–Ω–æ –Ω–æ–≤–∏–π –º–æ–¥—É–ª—å Dashboard –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —Ç–∞ —Ç—å—é—Ç–æ—Ä—ñ–≤ –∑ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏.

---

## ‚úÖ –í–ò–ö–û–ù–ê–ù–Ü –ó–ê–í–î–ê–ù–ù–Ø

### B1: Dashboard App Setup ‚úÖ
- –°—Ç–≤–æ—Ä–µ–Ω–æ `apps/dashboard/` –∑ –ø–æ–≤–Ω–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é
- –î–æ–¥–∞–Ω–æ –≤ `INSTALLED_APPS`
- –ó–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ URLs –≤ `config/urls.py`

### B2: Student Dashboard Endpoints ‚úÖ
- `GET /api/v1/dashboard/student/` ‚Äî –≥–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞
- `GET /api/v1/dashboard/student/active-lessons/` ‚Äî –∞–∫—Ç–∏–≤–Ω—ñ —É—Ä–æ–∫–∏
- `GET /api/v1/dashboard/student/teacher/` ‚Äî –∑–∞–∫—Ä—ñ–ø–ª–µ–Ω–∏–π —Ç—å—é—Ç–æ—Ä
- `GET /api/v1/dashboard/student/stats/` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### B3: Tutor Dashboard Endpoints ‚úÖ
- `GET /api/v1/dashboard/tutor/` ‚Äî –≥–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞
- `GET /api/v1/dashboard/tutor/upcoming/` ‚Äî –º–∞–π–±—É—Ç–Ω—ñ —É—Ä–æ–∫–∏
- `GET /api/v1/dashboard/tutor/students/` ‚Äî —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
- `GET /api/v1/dashboard/tutor/stats/` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### B4: Dashboard Serializers ‚úÖ
- `ActiveLessonSerializer` ‚Äî —É—Ä–æ–∫–∏ –∑ can_join –ª–æ–≥—ñ–∫–æ—é
- `AssignedTutorSerializer` ‚Äî —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ç—å—é—Ç–æ—Ä–∞
- `StudentStatsSerializer` / `TutorStatsSerializer`

### B5: Dashboard URLs ‚úÖ
- –í—Å—ñ endpoints –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –∑ namespace `dashboard-api`

### B6: Booking Model Extension ‚úÖ
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —ñ—Å–Ω—É—é—á–∏–π –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –∑–≤'—è–∑–æ–∫ `ClassroomSession.booking ‚Üí Booking.classroom_session`
- –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –Ω–æ–≤–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è

### B7: Auto-create ClassroomSession on Booking Confirm ‚úÖ
- –û–Ω–æ–≤–ª–µ–Ω–æ `BookingService.confirm_booking()`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ—Å—ñ—ó –ø—Ä–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—ñ

### B8: Booking Classroom Endpoint ‚úÖ
- `GET /api/v1/booking/bookings/{id}/classroom/`
- –ü–æ–≤–µ—Ä—Ç–∞—î session_id, JWT token, URL, status

### B9: Booking Serializer Update ‚úÖ
- –î–æ–¥–∞–Ω–æ `classroom_session_id` field
- –î–æ–¥–∞–Ω–æ `can_join_classroom` field –∑ –ª–æ–≥—ñ–∫–æ—é —á–∞—Å–æ–≤–æ–≥–æ –≤—ñ–∫–Ω–∞

### B10: Dashboard Service ‚úÖ
- `DashboardService` –∑ –º–µ—Ç–æ–¥–∞–º–∏ –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö

### B11: Migration ‚úÖ
- –ú—ñ–≥—Ä–∞—Ü—ñ—è –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ (–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —ñ—Å–Ω—É—é—á–∏–π –∑–≤'—è–∑–æ–∫)

### B12: Tests ‚úÖ
- –°—Ç–≤–æ—Ä–µ–Ω–æ `test_dashboard_api.py` –∑ —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –≤—Å—ñ—Ö endpoints

---

## üìÅ –ù–û–í–Ü –§–ê–ô–õ–ò

```
apps/dashboard/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ apps.py
‚îú‚îÄ‚îÄ services.py
‚îú‚îÄ‚îÄ urls.py
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îî‚îÄ‚îÄ views.py
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ test_dashboard_api.py
```

---

## üìù –ó–ú–Ü–ù–ï–ù–Ü –§–ê–ô–õ–ò

| –§–∞–π–ª | –ó–º—ñ–Ω–∏ |
|------|-------|
| `config/settings.py` | –î–æ–¥–∞–Ω–æ `apps.dashboard` |
| `config/urls.py` | –î–æ–¥–∞–Ω–æ dashboard URLs |
| `apps/booking/models/booking.py` | –ö–æ–º–µ–Ω—Ç–∞—Ä –ø—Ä–æ reverse relation |
| `apps/booking/services/booking_service.py` | Auto-create session on confirm |
| `apps/booking/api/views.py` | –î–æ–¥–∞–Ω–æ `BookingClassroomView` |
| `apps/booking/api/serializers.py` | –î–æ–¥–∞–Ω–æ classroom fields |
| `apps/booking/urls.py` | –î–æ–¥–∞–Ω–æ classroom endpoint |

---

## üîó –ù–û–í–Ü ENDPOINTS

| Method | Endpoint | –û–ø–∏—Å |
|--------|----------|------|
| GET | `/api/v1/dashboard/student/` | Student dashboard |
| GET | `/api/v1/dashboard/student/active-lessons/` | Active lessons |
| GET | `/api/v1/dashboard/student/teacher/` | Assigned tutor |
| GET | `/api/v1/dashboard/student/stats/` | Student stats |
| GET | `/api/v1/dashboard/tutor/` | Tutor dashboard |
| GET | `/api/v1/dashboard/tutor/upcoming/` | Upcoming lessons |
| GET | `/api/v1/dashboard/tutor/students/` | Tutor's students |
| GET | `/api/v1/dashboard/tutor/stats/` | Tutor stats |
| GET | `/api/v1/booking/bookings/{id}/classroom/` | Classroom session info |

---

## üîÑ INTEGRATION FLOW

```
1. Student finds tutor (Marketplace)
         ‚Üì
2. Student books lesson (Booking)
         ‚Üì
3. Tutor confirms booking
         ‚Üì
4. ClassroomSession auto-created
         ‚Üì
5. Both can join classroom 15min before
         ‚Üì
6. Lesson conducted with whiteboard + video
         ‚Üì
7. Session completed, stats updated
```

---

## üìà –ú–ï–¢–†–ò–ö–ò

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–Ω—è |
|---------|----------|
| –ù–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤ | 8 |
| –ó–º—ñ–Ω–µ–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ | 7 |
| –†—è–¥–∫—ñ–≤ –∫–æ–¥—É | ~750 |
| –ù–æ–≤–∏—Ö endpoints | 9 |
| Test cases | 15 |

---

## ‚ö†Ô∏è –ü–†–ò–ú–Ü–¢–ö–ò

1. **Reverse Relation**: `Booking.classroom_session` –¥–æ—Å—Ç—É–ø–Ω–∏–π —á–µ—Ä–µ–∑ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –∑–≤'—è–∑–æ–∫ –≤—ñ–¥ `ClassroomSession.booking`
2. **Signals**: –Ü—Å–Ω—É—é—á—ñ —Å–∏–≥–Ω–∞–ª–∏ –≤ `apps/classroom/signals.py` —Ç–∞–∫–æ–∂ —Å—Ç–≤–æ—Ä—é—é—Ç—å —Å–µ—Å—ñ—é –ø—Ä–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—ñ
3. **JWT Token**: –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `ClassroomTokenService`

---

## üß™ –¢–ï–°–¢–£–í–ê–ù–ù–Ø

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–∏
python manage.py check

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤ dashboard
pytest apps/dashboard/tests/ -v

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python manage.py runserver
```

---

## ‚úÖ DEFINITION OF DONE

- [x] Dashboard app —Å—Ç–≤–æ—Ä–µ–Ω–æ
- [x] Student endpoints –ø—Ä–∞—Ü—é—é—Ç—å
- [x] Tutor endpoints –ø—Ä–∞—Ü—é—é—Ç—å
- [x] Serializers –≥–æ—Ç–æ–≤—ñ
- [x] URLs –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ
- [x] Classroom integration —á–µ—Ä–µ–∑ reverse relation
- [x] Auto-create session –ø—Ä–∞—Ü—é—î
- [x] Booking classroom endpoint
- [x] Booking serializer –æ–Ω–æ–≤–ª–µ–Ω–æ
- [x] Dashboard service
- [x] –¢–µ—Å—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ
- [x] System check passed

---

*M4SH Platform v0.25-FIX ‚Äî Backend Integration Layer Complete*
