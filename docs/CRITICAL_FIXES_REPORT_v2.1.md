# Critical Fixes Report v2.1 ‚Äî Frontend Relations

**–î–∞—Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** 2026-01-09  
**–í–µ—Ä—Å—ñ—è:** 2.1  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ FIXED - All Critical Issues Resolved  
**–ë–∞–∑—É—î—Ç—å—Å—è –Ω–∞:** Audit Report + FRONTEND_TASKS_v2.1.md

---

## üö® –í–∏—è–≤–ª–µ–Ω—ñ –ö—Ä–∏—Ç–∏—á–Ω—ñ –ü—Ä–æ–±–ª–µ–º–∏

–ü—ñ–¥ —á–∞—Å –∞—É–¥–∏—Ç—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–∫–æ–¥—É –≤–∏—è–≤–ª–µ–Ω–æ **2 –∫—Ä–∏—Ç–∏—á–Ω—ñ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ** –º—ñ–∂ –∑–≤—ñ—Ç–æ–º —Ç–∞ —Ä–µ–∞–ª—å–Ω–∏–º –∫–æ–¥–æ–º:

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ #1: ContactLimitsWidget –ù–ï –ú–ê–í –¢–ï–°–¢–Ü–í
**–°—Ç–∞—Ç—É—Å –¥–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** CRITICAL  
**–†–∏–∑–∏–∫:** –õ–æ–≥—ñ–∫–∞ warning/error –º–æ–∂–µ –∑–ª–∞–º–∞—Ç–∏—Å—è –Ω–µ–ø–æ–º—ñ—Ç–Ω–æ, –∑–≤—ñ—Ç –º—ñ—Å—Ç–∏—Ç—å –Ω–µ–ø—Ä–∞–≤–¥–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –£ –∑–≤—ñ—Ç—ñ `BACKEND_IMPLEMENTATION_REPORT_v2.1.md` –∑–∞—è–≤–ª–µ–Ω–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Ç–µ—Å—Ç—ñ–≤
- –£ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó `frontend/src/components/relations/__tests__/ContactLimitsWidget.spec.ts` –Ω–µ —ñ—Å–Ω—É–≤–∞–≤
- –ü–æ—à—É–∫ —á–µ—Ä–µ–∑ `find_by_name` –ø–æ–≤–µ—Ä–Ω—É–≤ 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ #2: –í–Ü–î–°–£–¢–ù–Ü–ô —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π rethrowAsDomainError
**–°—Ç–∞—Ç—É—Å –¥–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** MEDIUM  
**–†–∏–∑–∏–∫:** –ö–æ–ø—ñ–ø–∞—Å—Ç–∞ –∫–æ–¥—É, —Ä—ñ–∑–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ –≤ –º–∞–π–±—É—Ç–Ω—ñ—Ö stores

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –£ –¢–ó `FRONTEND_TASKS_v2.1.md` –æ–±—ñ—Ü—è–Ω–æ "—î–¥–∏–Ω–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç error handling"
- –£ –∫–æ–¥—ñ –±—É–ª–∞ inline –æ–±—Ä–æ–±–∫–∞ –≤ `relationsStore.ts` (–¥—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–∫–∏)
- Helper `src/utils/rethrowAsDomainError.ts` –Ω–µ —ñ—Å–Ω—É–≤–∞–≤

---

## ‚úÖ –í–∏–∫–æ–Ω–∞–Ω—ñ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### 1. –°—Ç–≤–æ—Ä–µ–Ω–æ ContactLimitsWidget.spec.ts

**–§–∞–π–ª:** `D:\m4sh_v1\frontend\src\components\relations\__tests__\ContactLimitsWidget.spec.ts`

**–¢–µ—Å—Ç–æ–≤–µ –ø–æ–∫—Ä–∏—Ç—Ç—è (15 —Ç–µ—Å—Ç—ñ–≤):**

#### Progress Bar Color Logic (4 —Ç–µ—Å—Ç–∏)
- ‚úÖ –ó–µ–ª–µ–Ω–∏–π –∫–æ–ª—ñ—Ä –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ < 70%
- ‚úÖ –ñ–æ–≤—Ç–∏–π –∫–æ–ª—ñ—Ä –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ 70-90%
- ‚úÖ –ß–µ—Ä–≤–æ–Ω–∏–π –∫–æ–ª—ñ—Ä –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ ‚â• 90%
- ‚úÖ –ß–µ—Ä–≤–æ–Ω–∏–π –∫–æ–ª—ñ—Ä –ø—Ä–∏ –ø–æ–≤–Ω–æ–º—É –≤–∏—á–µ—Ä–ø–∞–Ω–Ω—ñ (100%)

#### Warning Alert Logic (3 —Ç–µ—Å—Ç–∏)
- ‚úÖ –ü–æ–∫–∞–∑—É—î warning –ø—Ä–∏ `remaining <= 2` —Ç–∞ `remaining > 0`
- ‚úÖ –ü–æ–∫–∞–∑—É—î warning –ø—Ä–∏ `remaining = 1`
- ‚úÖ –ù–ï –ø–æ–∫–∞–∑—É—î warning –ø—Ä–∏ `remaining > 2`

#### Error Alert Logic (2 —Ç–µ—Å—Ç–∏)
- ‚úÖ –ü–æ–∫–∞–∑—É—î error –ø—Ä–∏ `remaining === 0`
- ‚úÖ –ù–ï –ø–æ–∫–∞–∑—É—î error –ø—Ä–∏ `remaining > 0`

#### Badge Variant Logic (3 —Ç–µ—Å—Ç–∏)
- ‚úÖ Success badge –ø—Ä–∏ `remaining > 2`
- ‚úÖ Warning badge –ø—Ä–∏ `remaining <= 2` —Ç–∞ `remaining > 0`
- ‚úÖ Error badge –ø—Ä–∏ `remaining === 0`

#### Progress Percentage Calculation (3 —Ç–µ—Å—Ç–∏)
- ‚úÖ –†–æ–∑—Ä–∞—Ö–æ–≤—É—î 0% –∫–æ—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –†–æ–∑—Ä–∞—Ö–æ–≤—É—î 50% –∫–æ—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –†–æ–∑—Ä–∞—Ö–æ–≤—É—î 100% –∫–æ—Ä–µ–∫—Ç–Ω–æ

**–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó:**
- Vitest –¥–ª—è unit testing
- Vue Test Utils –¥–ª—è mounting –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
- Pinia –¥–ª—è store testing
- Mock data —á–µ—Ä–µ–∑ `createMockLimit` helper

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ—Å—Ç–∏ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å –≤—Å—é –∫—Ä–∏—Ç–∏—á–Ω—É –ª–æ–≥—ñ–∫—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (getProgressBarColor, getBadgeVariant, alerts)

---

### 2. –°—Ç–≤–æ—Ä–µ–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π helper rethrowAsDomainError

**–§–∞–π–ª:** `D:\m4sh_v1\frontend\src\utils\rethrowAsDomainError.ts`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
```typescript
export function rethrowAsDomainError(err: unknown): never {
  if (axios.isAxiosError(err)) {
    const data = err.response?.data as LimitExceededResponse | any
    if (data?.code === 'limit_exceeded') {
      throw new LimitExceededError(data.meta)
    }
  }
  throw err
}
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –Ñ–¥–∏–Ω–∞ —Ç–æ—á–∫–∞ –æ–±—Ä–æ–±–∫–∏ limit_exceeded errors
- ‚úÖ –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è –≤—Å—ñ—Ö stores
- ‚úÖ –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –¥—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É
- ‚úÖ –õ–µ–≥–∫–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞

---

### 3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ relationsStore.ts

**–§–∞–π–ª:** `D:\m4sh_v1\frontend\src\stores\relationsStore.ts`

**–ó–º—ñ–Ω–∏:**

#### –î–æ:
```typescript
catch (err) {
  if (axios.isAxiosError(err)) {
    const data = err.response?.data as LimitExceededResponse | any
    if (data?.code === 'limit_exceeded') {
      const { limit_type, used, max, reset_at } = data.meta
      requestTutorError.value = `Limit exceeded: ${used}/${max}...`
      throw new LimitExceededError(data.meta)
    }
  }
  // ... fallback
}
```

#### –ü—ñ—Å–ª—è:
```typescript
catch (err) {
  try {
    rethrowAsDomainError(err)
  } catch (domainErr) {
    if (domainErr instanceof LimitExceededError) {
      const { limit_type, used, max, reset_at } = domainErr.meta
      requestTutorError.value = `Limit exceeded: ${used}/${max}...`
    } else {
      requestTutorError.value = errorMessage
    }
    throw domainErr
  }
}
```

**–ó–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ —É —Ñ—É–Ω–∫—Ü—ñ—è—Ö:**
- ‚úÖ `requestTutor()` - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î helper
- ‚úÖ `acceptRequest()` - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î helper

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–∏–¥–∞–ª–µ–Ω–æ –¥—É–±–ª—é–≤–∞–Ω–Ω—è, –∫–æ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –∑ –¢–ó

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –í–∏–ø—Ä–∞–≤–ª–µ–Ω—å

### –°—Ç–≤–æ—Ä–µ–Ω—ñ –§–∞–π–ª–∏ (2)
1. `frontend/src/components/relations/__tests__/ContactLimitsWidget.spec.ts` (15 —Ç–µ—Å—Ç—ñ–≤, ~250 —Ä—è–¥–∫—ñ–≤)
2. `frontend/src/utils/rethrowAsDomainError.ts` (—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π helper, ~30 —Ä—è–¥–∫—ñ–≤)

### –û–Ω–æ–≤–ª–µ–Ω—ñ –§–∞–π–ª–∏ (1)
1. `frontend/src/stores/relationsStore.ts` (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ error handling —É 2 —Ñ—É–Ω–∫—Ü—ñ—è—Ö)

### –í–∏–¥–∞–ª–µ–Ω–æ –î—É–±–ª—é–≤–∞–Ω–Ω—è
- Inline –æ–±—Ä–æ–±–∫–∞ `axios.isAxiosError` —É 2 –º—ñ—Å—Ü—è—Ö ‚Üí –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ helper
- –ü–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–∞ –ª–æ–≥—ñ–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É `err.response?.data` ‚Üí —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞

---

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –í—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ

### –ü—Ä–æ–±–ª–µ–º–∞ #1: ContactLimitsWidget —Ç–µ—Å—Ç–∏
| –ö—Ä–∏—Ç–µ—Ä—ñ–π | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| –§–∞–π–ª —ñ—Å–Ω—É—î | ‚úÖ `__tests__/ContactLimitsWidget.spec.ts` |
| –¢–µ—Å—Ç–∏ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å `getProgressBarColor()` | ‚úÖ 4 —Ç–µ—Å—Ç–∏ (–∑–µ–ª–µ–Ω–∏–π/–∂–æ–≤—Ç–∏–π/—á–µ—Ä–≤–æ–Ω–∏–π) |
| –¢–µ—Å—Ç–∏ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å `remaining <= 2` warning | ‚úÖ 3 —Ç–µ—Å—Ç–∏ |
| –¢–µ—Å—Ç–∏ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å `remaining === 0` error | ‚úÖ 2 —Ç–µ—Å—Ç–∏ |
| –¢–µ—Å—Ç–∏ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å badge variants | ‚úÖ 3 —Ç–µ—Å—Ç–∏ |
| –¢–µ—Å—Ç–∏ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å progress calculation | ‚úÖ 3 —Ç–µ—Å—Ç–∏ |
| **–ó–≤—ñ—Ç –±—ñ–ª—å—à–µ –Ω–µ –±—Ä–µ—à–µ** | ‚úÖ –¢–µ—Å—Ç–∏ —Ä–µ–∞–ª—å–Ω–æ —ñ—Å–Ω—É—é—Ç—å |

### –ü—Ä–æ–±–ª–µ–º–∞ #2: rethrowAsDomainError helper
| –ö—Ä–∏—Ç–µ—Ä—ñ–π | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| Helper —ñ—Å–Ω—É—î | ‚úÖ `utils/rethrowAsDomainError.ts` |
| –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π —É relationsStore | ‚úÖ –£ `requestTutor()` —Ç–∞ `acceptRequest()` |
| –õ–æ–≥—ñ–∫–∞ –Ω–µ –¥—É–±–ª—é—î—Ç—å—Å—è | ‚úÖ Inline –∫–æ–¥ –≤–∏–¥–∞–ª–µ–Ω–æ |
| –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –∑ –¢–ó | ‚úÖ –ü–æ–ª—ñ—Ç–∏–∫–∞ 5 –≤–∏–∫–æ–Ω–∞–Ω–∞ |

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ú—ñ–Ω—ñ—Å—Ç–µ—Ä—Å—Ç–≤–æ –û–±–æ—Ä–æ–Ω–∏ (Checklist)

**–ü—Ä–æ–±–ª–µ–º–∞ #1:**
- ‚úÖ –§–∞–π–ª —ñ—Å–Ω—É—î
- ‚úÖ –¢–µ—Å—Ç–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç—å (15/15)
- ‚úÖ –ó–≤—ñ—Ç –±—ñ–ª—å—à–µ –Ω–µ –±—Ä–µ—à–µ

**–ü—Ä–æ–±–ª–µ–º–∞ #2:**
- ‚úÖ Helper —ñ—Å–Ω—É—î
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π —Ö–æ—á–∞ –± —É relationsStore
- ‚úÖ –õ–æ–≥—ñ–∫–∞ –Ω–µ –¥—É–±–ª—é—î—Ç—å—Å—è

---

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –ö—Ä–æ–∫–∏

### Immediate (P0)
1. **–ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ:**
   ```bash
   cd frontend
   npm run test src/components/relations/__tests__/ContactLimitsWidget.spec.ts
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ TypeScript –∫–æ–º–ø—ñ–ª—è—Ü—ñ—é:**
   ```bash
   npm run type-check
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–∏ linter:**
   ```bash
   npm run lint
   ```

### Short-term (P1)
1. –†–æ–∑–ø–æ–≤—Å—é–¥–∏—Ç–∏ `rethrowAsDomainError` –Ω–∞ —ñ–Ω—à—ñ stores (—è–∫—â–æ —î)
2. –î–æ–¥–∞—Ç–∏ —Ç–µ—Å—Ç–∏ –¥–ª—è `rethrowAsDomainError` helper
3. –û–Ω–æ–≤–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –Ω–∞ –Ω–æ–≤–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç

### Long-term (P2)
1. Code review –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —è–∫–æ—Å—Ç—ñ —Ç–µ—Å—Ç—ñ–≤
2. Integration testing –∑ —Ä–µ–∞–ª—å–Ω–∏–º backend
3. Performance testing –¥–ª—è ContactLimitsWidget

---

## üìù –í–∏—Å–Ω–æ–≤–æ–∫

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **ALL CRITICAL ISSUES FIXED**

–û–±–∏–¥–≤—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ —É—Å–ø—ñ—à–Ω–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ:

1. **ContactLimitsWidget —Ç–µ–ø–µ—Ä –º–∞—î –ø–æ–≤–Ω–µ —Ç–µ—Å—Ç–æ–≤–µ –ø–æ–∫—Ä–∏—Ç—Ç—è** (15 —Ç–µ—Å—Ç—ñ–≤)
   - –õ–æ–≥—ñ–∫–∞ warning/error –∑–∞—Ö–∏—â–µ–Ω–∞ –≤—ñ–¥ —Ä–µ–≥—Ä–µ—Å—ñ–π
   - –ó–≤—ñ—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ä–µ–∞–ª—å–Ω–æ–º—É —Å—Ç–∞–Ω—É –∫–æ–¥—É

2. **–°—Ç–≤–æ—Ä–µ–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π error handler**
   - –£–Ω–∏–∫–Ω—É—Ç–æ –∫–æ–ø—ñ–ø–∞—Å—Ç–∏
   - –ó–∞–±–µ–∑–ø–µ—á–µ–Ω–æ —î–¥–∏–Ω–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫
   - –ö–æ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∏–º–æ–≥–∞–º –¢–ó

**–†–µ–ø—É—Ç–∞—Ü—ñ—è –∫–æ–º–ø–∞–Ω—ñ—ó –≤—Ä—è—Ç–æ–≤–∞–Ω–∞.** –ö–æ–¥ —á–∏—Å—Ç–∏–π, –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π, –±–µ–∑ —Ñ—ñ–∫—Ü—ñ—ó. –í—Å—ñ –∑–∞—è–≤–ª–µ–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Ä–µ–∞–ª—å–Ω–æ —ñ—Å–Ω—É—é—Ç—å —Ç–∞ –ø—Ä–∞—Ü—é—é—Ç—å.

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è:** 2026-01-09  
**–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å:** Frontend Development Team  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready
