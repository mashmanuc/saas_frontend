# Технічне завдання: інтеграція UI Contract System

## 1. Мета
Запровадити ізольовану бібліотеку `assets2/ui-contract` як фундаментальний UI-шар для всієї платформи, забезпечивши сумісність з існуючим темінгом, поступову міграцію компонентів та відсутність регресій у продуктивності, доступності й контрактних API.

## 2. Результати аудиту
1. **Архітектура**: `ui-contract` містить токени (`tokens.css`), набір базових контролів (Button, Modal, Select, Dropdown, FormField) та документацію з правилами використання. Стилі інкапсульовано через CSS Modules, токени наслідують глобальні змінні `src/assets/main.css`, що гарантує узгодженість тем.
2. **Теми**: бібліотека покладається на `data-theme` і CSS-змінні, тож автоматично підтримує light/dark/classic. Потребує гарантії, що root елемент отримує атрибут (Pinia store це вже робить).
3. **Доступність**: компоненти мають aria-атрибути, focus-trap (Modal), клавіатурну навігацію (Dropdown/Select). Потрібні smoke-тести на реальних сценаріях.
4. **Залежності**: лише Vue 3 (Composition API) + локальні CSS. Немає зовнішніх пакетів, що спрощує інтеграцію.
5. **Ризики**:
   - Паралельні кастомні стилі можуть конфліктувати (особливо глобальні кнопки/inputs). Потрібне очищення legacy SCSS.
   - Відсутні складніші контролі (таблиці, date-picker). Фази мають включати план розширення або обгортання сторонніх компонентів.
   - Потрібен контроль за i18n: компоненти не містять тексту, але споживачі мають підключати ключі.
6. **Оппортуніті**: єдина система токенів, швидке масштабування тем, можливість reuse в майбутніх продуктах.

## 3. Scope
- Впровадження глобальних токенів `ui-contract` у фронтенд застосунок.
- Міграція критичних контролів (кнопки, form fields, модалки, дропдауни, select) у визначених модулях.
- Актуалізація документації та тестів (unit, E2E, accessibility).
- Визначення плану розширення бібліотеки під додаткові сценарії (таблиці, тости, плашки статусів).

## 4. Вимоги
1. **Технічні**
   - Обовʼязковий імпорт `@/assets2/ui-contract/tokens/tokens.css` у `src/main.js` або `App.vue` до рендера додатку.
   - Заборонено перевизначати стилі компонентів через глобальні селектори/`!important`. Дозволено лише layout-класи.
   - Усі нові UI-компоненти фронтенду повинні будуватися на токенах `ui-contract`.
   - Якщо компоненту бракує функціоналу, зміни вносяться в бібліотеку централізовано, а не локальними патчами.
2. **Доступність**
   - Валідація focus states, aria-атрибутів, керування з клавіатури (WCAG 2.1 AA).
   - Modal: обовʼязкові автотести на focus-trap і повернення фокусу після закриття.
3. **Тести**
   - Vitest: покриття основних props/станів для кожного адаптованого компоненту.
   - Cypress/Playwright: smoke-флоу для екрану, де зʼявився новий کنترل.
4. **Документація**
   - Оновити `docs/architecture` (цей файл + діючі специфікації модулів) з описом використання `ui-contract`.
   - У релізних документах `docs/plan/vX.Y/vX.Y.0 frontend.md` додати секцію FE↔BE: ендпоїнти, sequence та error→UX mapping, якщо змінюються інтерфейси.

## 5. Фази впровадження
### Фаза 0 — Підготовка
- Імпорт токенів у root та smoke-тест тем (light/dark/classic).
- Перевірка, що `document.documentElement` отримує коректний `data-theme`.
- Створення QA-checklist та оновлення Storybook/Playground (за потреби).

### Фаза 1 — Пілотний модуль
- Обрати один високоприорітетний флоу (наприклад, редагування профілю викладача).
- Замінити локальні кнопки, інпути, модалки, дропдауни на `ui-contract`.
- Додати unit + e2e тести на цей флоу, оновити документацію.
- Виміряти продуктивність (LCP/CLS) і переконатися у відсутності регресій.

### Фаза 2 — Розширення
- Скласти список решти модулів з пріоритетами та залежностями.
- Для кожного модуля: підготувати mini-TЗ (контакти з BE, винятки), виконати міграцію, оновити тести й документувати.
- Розширити бібліотеку, якщо потрібні додаткові контролі (checkbox, radio, tabs, toast). Кожне розширення — окремий пакет змін з тестами.

### Фаза 3 — Стандартизація
- Заборонити нові компоненти поза `ui-contract` без архітектурного погодження.
- Налаштувати lint-правила/кодуаналіз для контролю використання токенів.
- Внести `ui-contract` у Platform Manifest як обовʼязковий фундаментальний шар.

## 6. Acceptance Criteria
- Токени підключені глобально, теми перемикаються без регресій.
- Принаймні один ключовий флоу працює на `ui-contract` і пройшов e2e перевірку.
- Усі зміни задокументовано, релізні плани оновлені.
- Створено backlog фаз 2–3 із визначеними строками/відповідальними.

## 7. Ризики та Mitigation
| Ризик | Вплив | Mitigation |
|-------|-------|------------|
| Конфлікт стилів з legacy SCSS | Середній | Поступове відключення глобальних стилів у модулі після міграції; в ревʼю перевіряти `scoped`/CSS Modules |
| Недостатнє покриття тестами | Високий | Обовʼязкові unit + e2e smoke на кожну фазу, інтегрувати в CI |
| Відсутність потрібних контролів | Середній | Планувати розширення бібліотеки наперед, PRD/дизайн на нові компоненти перед фазою 2 |
| Тема/токени не синхронізуються | Низький | Smoke-тести тем, перевірка `data-theme`, моніторинг у QA |

## 8. План комунікацій
- Архітектурний ревʼю кожної фази (Front/Back техрадам). 
- QA sign-off після кожної хвилі.
- Оновлення релізних нотаток із переліком екранів, які мігрували.

---
**Відповідальний за виконання:** команда фронтенду (агентні моделі).  Керівний документ — цей ТЗ + Manifest платформи.
