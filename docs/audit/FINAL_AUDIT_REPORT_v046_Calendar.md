# üìã –ü–Ü–î–°–£–ú–ö–û–í–ò–ô –ó–í–Ü–¢ –ê–£–î–ò–¢–£: –ö–∞–ª–µ–Ω–¥–∞—Ä v0.46

**–î–∞—Ç–∞:** 23 –≥—Ä—É–¥–Ω—è 2024  
**–í–µ—Ä—Å—ñ—è:** v0.46.1-v0.46.2  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–†–ò–¢–ò–ß–ù–Ü –ü–†–û–ë–õ–ï–ú–ò –í–ò–ü–†–ê–í–õ–ï–ù–û

---

## üéØ EXECUTIVE SUMMARY

### –ü–æ—á–∞—Ç–∫–æ–≤–∞ –ø—Ä–æ–±–ª–µ–º–∞
–ö–∞–ª–µ–Ω–¥–∞—Ä v0.46 –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞–≤ –∂–æ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö. API –ø–æ–≤–µ—Ä—Ç–∞–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π –º–∞—Å–∏–≤ `cells: []`, —á–µ—Ä–µ–∑ —â–æ UI –ø–æ–∫–∞–∑—É–≤–∞–≤ –ø—É—Å—Ç–∏–π –µ–∫—Ä–∞–Ω.

### Root Cause
**–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –≤ backend –∫–æ–¥—ñ:** –ù–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –∫–ª—é—á—ñ–≤ JSON –º—ñ–∂ –º–æ–¥–µ–ª–ª—é –¥–∞–Ω–∏—Ö —Ç–∞ –∫–æ–¥–æ–º –æ–±—Ä–æ–±–∫–∏.

- **–ú–æ–¥–µ–ª—å:** `weekly_slots` –º—ñ—Å—Ç–∏—Ç—å `start` —Ç–∞ `end`
- **–ö–æ–¥:** –®—É–∫–∞–≤ `start_time` —Ç–∞ `end_time`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ñ–æ–¥–µ–Ω —Å–ª–æ—Ç –Ω–µ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è ‚Üí –ø–æ—Ä–æ–∂–Ω—ñ–π –∫–∞–ª–µ–Ω–¥–∞—Ä

### –í–∏–∫–æ–Ω–∞–Ω—ñ —Ä–æ–±–æ—Ç–∏
1. ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω—É –ø–æ–º–∏–ª–∫—É –≤ `week_generator.py`
2. ‚úÖ –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
3. ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ management command –¥–ª—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
4. ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ UX –∑ empty state —Ç–∞ –∫–Ω–æ–ø–∫–æ—é –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
5. ‚úÖ –î–æ–¥–∞–Ω–æ dev mock –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
6. ‚úÖ –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –∞—É–¥–∏—Ç –∑–∞—Å—Ç–∞—Ä—ñ–ª–æ–≥–æ –∫–æ–¥—É

---

## üîß –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø

### 1. Backend: week_generator.py

**–§–∞–π–ª:** `backend/apps/booking/services/week_generator.py`

**–ó–º—ñ–Ω–∏:**

```python
# –ë—É–ª–æ (–ü–û–ú–ò–õ–ö–ê):
start_time_str = slot_data.get('start_time')  # None
end_time_str = slot_data.get('end_time')      # None

# –°—Ç–∞–ª–æ (–í–ò–ü–†–ê–í–õ–ï–ù–û):
start_time_str = slot_data.get('start') or slot_data.get('start_time')
end_time_str = slot_data.get('end') or slot_data.get('end_time')
```

**–î–æ–¥–∞–Ω–æ:**
- Backward compatibility –¥–ª—è –æ–±–æ—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤
- Warning –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è invalid slots
- –î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–ª—ñ—Ç–∏–Ω–æ–∫
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –Ω–∞ –∫–æ–∂–Ω–æ–º—É –µ—Ç–∞–ø—ñ (template, exceptions, bookings)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** API —Ç–µ–ø–µ—Ä –∫–æ—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–æ–±–ª—è—î `weekly_slots` —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –∫–ª—ñ—Ç–∏–Ω–∫–∏ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏.

---

### 2. Backend: Management Command

**–§–∞–π–ª:** `backend/apps/booking/management/commands/create_test_availability.py`

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –®–≤–∏–¥–∫–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è —Ç—å—é—Ç–æ—Ä–∞

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```bash
# –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç—å—é—Ç–æ—Ä–∞
python manage.py create_test_availability --tutor-id=79

# –î–ª—è –ø–µ—Ä—à–æ–≥–æ –∑–Ω–∞–π–¥–µ–Ω–æ–≥–æ —Ç—å—é—Ç–æ—Ä–∞
python manage.py create_test_availability

# –û—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å–Ω—É—é—á–∏–π template
python manage.py create_test_availability --tutor-id=79 --clear
```

**–°—Ç–≤–æ—Ä—é—î:**
- –®–∞–±–ª–æ–Ω –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ –∑ 6 —Ä–æ–±–æ—á–∏–º–∏ –¥–Ω—è–º–∏
- –†—ñ–∑–Ω—ñ –≥–æ–¥–∏–Ω–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –¥–Ω—è
- Timezone: Europe/Kiev
- 13 —Å–ª–æ—Ç—ñ–≤ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å

---

### 3. Frontend: Empty State UI

**–§–∞–π–ª:** `frontend/src/modules/booking/components/calendar/CalendarCellGrid.vue`

**–î–æ–¥–∞–Ω–æ:**
- –Ü–∫–æ–Ω–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è (SVG)
- –ó—Ä–æ–∑—É–º—ñ–ª–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- –ö–Ω–æ–ø–∫–∞ "–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ä–æ–∑–∫–ª–∞–¥" ‚Üí `/booking/availability`
- –ö–Ω–æ–ø–∫–∞ "–û–Ω–æ–≤–∏—Ç–∏" –¥–ª—è retry

**i18n –∫–ª—é—á—ñ:**
```json
{
  "booking.calendar.noSchedule": "–†–æ–∑–∫–ª–∞–¥ –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ",
  "booking.calendar.noScheduleDesc": "–°—Ç–≤–æ—Ä—ñ—Ç—å —à–∞–±–ª–æ–Ω –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ, —â–æ–± —Å—Ç—É–¥–µ–Ω—Ç–∏ –º–æ–≥–ª–∏ –±—Ä–æ–Ω—é–≤–∞—Ç–∏ —É—Ä–æ–∫–∏",
  "booking.calendar.setupSchedule": "–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ä–æ–∑–∫–ª–∞–¥"
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –∫–æ—Ä–∏—Å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞–º—ñ—Å—Ç—å –ø—É—Å—Ç–æ–≥–æ –µ–∫—Ä–∞–Ω—É.

---

### 4. Frontend: Dev Mock

**–§–∞–π–ª:** `frontend/src/modules/booking/api/calendarApi.ts`

**–î–æ–¥–∞–Ω–æ:** –§—É–Ω–∫—Ü—ñ—è `generateMockCells()` –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑ –±–µ–∫–µ–Ω–¥—É

**–ê–∫—Ç–∏–≤–∞—Ü—ñ—è:**
```bash
# .env.development
VITE_USE_MOCK_CALENDAR=true
```

**–ì–µ–Ω–µ—Ä—É—î:**
- 6 —Ä–æ–±–æ—á–∏—Ö –¥–Ω—ñ–≤ (–ü–Ω-–°–±)
- –ì–æ–¥–∏–Ω–∏ 9:00-18:00
- –û–±—ñ–¥–Ω—è –ø–µ—Ä–µ—Ä–≤–∞ 12:00-13:00 (blocked)
- 2 –∑–∞–±—Ä–æ–Ω—å–æ–≤–∞–Ω—ñ —Å–ª–æ—Ç–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó
- –°–∏–º—É–ª—è—Ü—ñ—è –∑–∞—Ç—Ä–∏–º–∫–∏ –º–µ—Ä–µ–∂—ñ (500ms)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–æ–∑—Ä–æ–±–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ UI –±–µ–∑ –∑–∞–ø—É—â–µ–Ω–æ–≥–æ –±–µ–∫–µ–Ω–¥—É.

---

## üìä –ú–ï–¢–†–ò–ö–ò –í–ò–ü–†–ê–í–õ–ï–ù–¨

### –î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
- ‚ùå API –ø–æ–≤–µ—Ä—Ç–∞—î: `cells: []` (0 –∫–ª—ñ—Ç–∏–Ω–æ–∫)
- ‚ùå UI –ø–æ–∫–∞–∑—É—î: –ø—É—Å—Ç–∏–π –µ–∫—Ä–∞–Ω
- ‚ùå –õ–æ–≥–∏: –º–æ–≤—á–∞—Ç—å –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É
- ‚ùå –†–æ–∑—Ä–æ–±–Ω–∏–∫–∏: –Ω–µ –º–æ–∂—É—Ç—å —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –±–µ–∑ –±–µ–∫–µ–Ω–¥—É

### –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
- ‚úÖ API –ø–æ–≤–µ—Ä—Ç–∞—î: `cells: [...]` (336 –∫–ª—ñ—Ç–∏–Ω–æ–∫ –¥–ª—è —Ç–∏–∂–Ω—è)
- ‚úÖ UI –ø–æ–∫–∞–∑—É—î: –∫–∞–ª–µ–Ω–¥–∞—Ä –∑ –∫–ª—ñ—Ç–∏–Ω–∫–∞–º–∏ –∞–±–æ –∫–æ—Ä–∏—Å–Ω–∏–π empty state
- ‚úÖ –õ–æ–≥–∏: –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ–∂–µ–Ω –µ—Ç–∞–ø
- ‚úÖ –†–æ–∑—Ä–æ–±–Ω–∏–∫–∏: –º–æ–∂—É—Ç—å —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∑ mock –¥–∞–Ω–∏–º–∏

---

## üóëÔ∏è –ó–ê–°–¢–ê–†–Ü–õ–ò–ô –ö–û–î

### –î–ª—è –Ω–µ–≥–∞–π–Ω–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è

**1. backend/apps/calendar/**
- –î—É–±–ª—ñ–∫–∞—Ç —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É
- Mock –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ production
- **–î—ñ—è:** –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—é –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é

### –î–ª—è –∞–Ω–∞–ª—ñ–∑—É —Ç–∞ deprecation

**2. calendarStore –º–µ—Ç–æ–¥–∏:**
- `loadSlots()`, `loadWeekSlots()` - —Å—Ç–∞—Ä–∏–π API
- `blockSlot()`, `unblockSlot()` - –∑–∞–º—ñ–Ω–µ–Ω—ñ –Ω–∞ draft patches
- `createCustomSlot()` - –¥—É–±–ª—é—î manual booking

**3. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:**
- `WeekCalendar.vue` - –º–æ–∂–ª–∏–≤–æ –∑–∞–º—ñ–Ω–µ–Ω–∏–π –Ω–∞ `CalendarCellGrid.vue`
- `MonthCalendar.vue` - –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

**4. Backend endpoints:**
- `AvailableSlotsView` - –º–æ–∂–ª–∏–≤–æ –¥—É–±–ª—é—î Week View
- `BlockSlotView` / `UnblockSlotView` - –∑–∞–º—ñ–Ω–µ–Ω—ñ –Ω–∞ Bulk Apply

**–î–µ—Ç–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω:** `LEGACY_CODE_CLEANUP_v046.md`

---

## üöÄ –Ü–ù–°–¢–†–£–ö–¶–Ü–á –î–õ–Ø –ó–ê–ü–£–°–ö–£

### Backend

**1. –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```bash
cd backend
git pull  # –û—Ç—Ä–∏–º–∞—Ç–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
```

**2. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ:**
```bash
python manage.py create_test_availability --tutor-id=79
```

**3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ dev —Å–µ—Ä–≤–µ—Ä
python manage.py runserver

# –í —ñ–Ω—à–æ–º—É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏
tail -f logs/django.log | grep week_generator
```

**–û—á—ñ–∫—É–≤–∞–Ω—ñ –ª–æ–≥–∏:**
```
[week_generator] Starting generation for tutor_id=79, week_start=2025-12-22, tz=Europe/Kiev
[week_generator] Template found: True
[week_generator] Template weekly_slots count: 13
[week_generator] Generated base grid: 336 cells
[week_generator] After template: 156 available cells
[week_generator] Final stats: {'total': 336, 'empty': 180, 'available': 156, 'blocked': 0, 'booked': 0}
```

### Frontend

**1. –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```bash
cd frontend
git pull
npm install  # –Ø–∫—â–æ —î –Ω–æ–≤—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
```

**2. –û–ø—Ü—ñ—è A: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ —Ä–µ–∞–ª—å–Ω–∏–º API**
```bash
# .env.development
VITE_USE_MOCK_CALENDAR=false

npm run dev
```

**3. –û–ø—Ü—ñ—è B: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ mock –¥–∞–Ω–∏–º–∏**
```bash
# .env.development
VITE_USE_MOCK_CALENDAR=true

npm run dev
```

**4. –í—ñ–¥–∫—Ä–∏—Ç–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä:**
```
http://localhost:5173/booking/tutor
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –∫–ª—ñ—Ç–∏–Ω–∫–∏
- ‚úÖ –ó–µ–ª–µ–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ = available
- ‚úÖ –°—ñ—Ä—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ = empty
- ‚úÖ –ß–µ—Ä–≤–æ–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ = blocked
- ‚úÖ –°–∏–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ = booked
- ‚úÖ –ö–ª—ñ–∫ –Ω–∞ –∫–ª—ñ—Ç–∏–Ω–∫—É ‚Üí popover –∑ –¥—ñ—è–º–∏

---

## ‚ö†Ô∏è –í–Ü–î–û–ú–Ü –û–ë–ú–ï–ñ–ï–ù–ù–Ø

### 1. –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** –£ –±—ñ–ª—å—à–æ—Å—Ç—ñ —Ç—å—é—Ç–æ—Ä—ñ–≤ –Ω–µ–º–∞—î `TutorAvailabilityTemplate`  
**–†—ñ—à–µ–Ω–Ω—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ management command –∞–±–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ UI –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å

### 2. Timezone handling
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑ DST –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏  
**–°—Ç–∞—Ç—É—Å:** –ö–æ–¥ –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–π, –ø–æ—Ç—Ä–µ–±—É—î —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 3. Performance
**–ü—Ä–æ–±–ª–µ–º–∞:** –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è 336 –∫–ª—ñ—Ç–∏–Ω–æ–∫ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ–≤—ñ–ª—å–Ω–æ—é  
**–°—Ç–∞—Ç—É—Å:** –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ (3 –∑–∞–ø–∏—Ç–∏ –∑–∞–º—ñ—Å—Ç—å N+1), –∞–ª–µ –ø–æ—Ç—Ä–µ–±—É—î –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

---

## üìà –†–ï–ö–û–ú–ï–ù–î–ê–¶–Ü–á –î–õ–Ø –°–¢–ê–ë–Ü–õ–Ü–ó–ê–¶–Ü–á

### –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 1: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

**1. –î–æ–¥–∞—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏:**
```python
# –í week_generator.py
import time
start_time = time.time()
# ... generation code ...
duration = time.time() - start_time
logger.info(f"[week_generator] Generation took {duration:.2f}s")
```

**2. –î–æ–¥–∞—Ç–∏ Sentry tracking:**
```python
if duration > 2.0:
    sentry_sdk.capture_message(
        f"Slow week generation: {duration:.2f}s for tutor {tutor_id}",
        level="warning"
    )
```

### –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 2: –í–∞–ª—ñ–¥–∞—Ü—ñ—è

**1. JSON Schema –¥–ª—è weekly_slots:**
```python
WEEKLY_SLOT_SCHEMA = {
    "type": "array",
    "items": {
        "type": "object",
        "required": ["weekday", "start", "end"],
        "properties": {
            "weekday": {"type": "integer", "minimum": 0, "maximum": 6},
            "start": {"type": "string", "pattern": "^[0-2][0-9]:[0-5][0-9]$"},
            "end": {"type": "string", "pattern": "^[0-2][0-9]:[0-5][0-9]$"}
        }
    }
}
```

**2. –î–æ–¥–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –≤ –º–æ–¥–µ–ª—å:**
```python
def clean(self):
    validate(self.weekly_slots, WEEKLY_SLOT_SCHEMA)
```

### –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 3: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**1. Unit —Ç–µ—Å—Ç–∏ –¥–ª—è week_generator:**
```python
def test_generate_week_cells_with_template():
    # Arrange
    template = create_test_template()
    
    # Act
    cells = generate_week_cells(tutor_id=1, week_start=date(2025, 12, 22))
    
    # Assert
    assert len(cells) == 336
    assert sum(1 for c in cells if c['status'] == 'available') > 0
```

**2. Integration —Ç–µ—Å—Ç–∏:**
```python
def test_week_view_api_returns_cells():
    response = client.get('/api/calendar/week/', {'start': '2025-12-22'})
    assert response.status_code == 200
    assert len(response.data['cells']) > 0
```

**3. E2E —Ç–µ—Å—Ç–∏ (Playwright):**
```typescript
test('calendar displays cells', async ({ page }) => {
  await page.goto('/booking/tutor')
  await expect(page.locator('.calendar-cell')).toHaveCount(336)
})
```

### –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

**1. API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:**
- –î–æ–¥–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–ø–∏—Ç—ñ–≤/–≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
- –î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ error codes
- –î–æ–¥–∞—Ç–∏ rate limiting info

**2. User –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:**
- –Ø–∫ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ä–æ–∑–∫–ª–∞–¥
- –Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ manual booking
- Troubleshooting guide

---

## üéì LESSONS LEARNED

### –©–æ –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫

1. **–ù–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó —Ç–∞ –∫–æ–¥—É**
   - –ü–ª–∞–Ω v0.46 –Ω–µ –∑–≥–∞–¥—É–≤–∞–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `weekly_slots`
   - –†–æ–∑—Ä–æ–±–Ω–∏–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–ª–∏ —ñ–Ω—à—ñ –∫–ª—é—á—ñ

2. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó**
   - JSON –≤ –ë–î –Ω–µ –≤–∞–ª—ñ–¥—É—î—Ç—å—Å—è
   - –ü–æ–º–∏–ª–∫–∏ –≤–∏—è–≤–ª—è—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –≤ runtime

3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—î –ª–æ–≥—É–≤–∞–Ω–Ω—è**
   - –í–∞–∂–∫–æ –¥—ñ–∞–≥–Ω–æ—Å—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏
   - –ù–µ–º–∞—î –º–µ—Ç—Ä–∏–∫ performance

4. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Ç–µ—Å—Ç—ñ–≤**
   - –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –Ω–µ –±—É–ª–∞ –≤–∏—è–≤–ª–µ–Ω–∞ –¥–æ production
   - –ù–µ–º–∞—î —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ç–µ—Å—Ç—ñ–≤

### –©–æ –∑—Ä–æ–±–∏—Ç–∏ —ñ–Ω–∞–∫—à–µ

1. **Contract-first —Ä–æ–∑—Ä–æ–±–∫–∞**
   - –°–ø–æ—á–∞—Ç–∫—É API –∫–æ–Ω—Ç—Ä–∞–∫—Ç
   - –ü–æ—Ç—ñ–º –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
   - –ü–æ—Ç—ñ–º —ñ–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—è

2. **–û–±–æ–≤'—è–∑–∫–æ–≤—ñ —Ç–µ—Å—Ç–∏**
   - Unit —Ç–µ—Å—Ç–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ—ó –ª–æ–≥—ñ–∫–∏
   - Integration —Ç–µ—Å—Ç–∏ –¥–ª—è API
   - E2E —Ç–µ—Å—Ç–∏ –¥–ª—è user flows

3. **–î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è**
   - –õ–æ–≥—É–≤–∞—Ç–∏ –≤—Å—ñ –≤–∞–∂–ª–∏–≤—ñ –µ—Ç–∞–ø–∏
   - –î–æ–¥–∞–≤–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç (IDs, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏)
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ structured logging

4. **Staging environment**
   - –¢–µ—Å—Ç—É–≤–∞—Ç–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏
   - –í–∏—è–≤–ª—è—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏ –¥–æ production

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ó–ê–í–ï–†–®–ï–ù–ù–Ø

### Backend
- [x] –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω—É –ø–æ–º–∏–ª–∫—É –≤ week_generator.py
- [x] –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è
- [x] –°—Ç–≤–æ—Ä–µ–Ω–æ management command –¥–ª—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
- [ ] –î–æ–¥–∞–Ω–æ unit —Ç–µ—Å—Ç–∏ –¥–ª—è generate_week_cells()
- [ ] –î–æ–¥–∞–Ω–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é JSON schema
- [ ] –î–æ–¥–∞–Ω–æ –º–µ—Ç—Ä–∏–∫–∏ performance
- [ ] –í–∏–¥–∞–ª–µ–Ω–æ apps/calendar/

### Frontend
- [x] –î–æ–¥–∞–Ω–æ empty state UI
- [x] –î–æ–¥–∞–Ω–æ i18n –∫–ª—é—á—ñ
- [x] –î–æ–¥–∞–Ω–æ dev mock
- [x] –î–æ–¥–∞–Ω–æ –∫–Ω–æ–ø–∫—É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
- [ ] –î–æ–¥–∞–Ω–æ E2E —Ç–µ—Å—Ç–∏
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ store
- [ ] –í–∏–¥–∞–ª–∏—Ç–∏ –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
- [x] –°—Ç–≤–æ—Ä–µ–Ω–æ CRITICAL_AUDIT_v046_Calendar.md
- [x] –°—Ç–≤–æ—Ä–µ–Ω–æ LEGACY_CODE_CLEANUP_v046.md
- [x] –°—Ç–≤–æ—Ä–µ–Ω–æ FINAL_AUDIT_REPORT_v046_Calendar.md
- [ ] –û–Ω–æ–≤–∏—Ç–∏ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ user guide –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
- [ ] –î–æ–¥–∞—Ç–∏ troubleshooting guide

### Testing
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ —Ç—å—é—Ç–æ—Ä–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∑ –ø–æ—Ä–æ–∂–Ω—ñ–º template
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∑ —Ä—ñ–∑–Ω–∏–º–∏ timezones
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ DST transitions
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ performance –∑ –≤–µ–ª–∏–∫–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é —Å–ª–æ—Ç—ñ–≤

---

## üéØ NEXT STEPS

### –ù–µ–≥–∞–π–Ω–æ (—Å—å–æ–≥–æ–¥–Ω—ñ)
1. ‚úÖ –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ dev —Å–µ—Ä–≤–µ—Ä—ñ
2. ‚úÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è —Ç—å—é—Ç–æ—Ä–∞ ID=79
3. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–±–æ—Ç—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è –≤ –±—Ä–∞—É–∑–µ—Ä—ñ
4. üîÑ –í–∏–¥–∞–ª–∏—Ç–∏ `backend/apps/calendar/`

### –ó–∞–≤—Ç—Ä–∞
1. –î–æ–¥–∞—Ç–∏ unit —Ç–µ—Å—Ç–∏ –¥–ª—è week_generator
2. –î–æ–¥–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é JSON schema
3. –ü—Ä–æ–≤–µ—Å—Ç–∏ grep search –¥–ª—è –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö –º–µ—Ç–æ–¥—ñ–≤
4. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –¥–ª—è deprecation

### –ù–∞—Å—Ç—É–ø–Ω–∏–π —Ç–∏–∂–¥–µ–Ω—å
1. –î–æ–¥–∞—Ç–∏ E2E —Ç–µ—Å—Ç–∏
2. –û–Ω–æ–≤–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é
3. –ü—Ä–æ–≤–µ—Å—Ç–∏ performance testing
4. –ü—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ –¥–æ production deploy

### –ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä–µ–ª—ñ–∑
1. –í–∏–¥–∞–ª–∏—Ç–∏ deprecated –∫–æ–¥
2. –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ performance
3. –î–æ–¥–∞—Ç–∏ advanced features (recurring bookings, bulk operations)

---

## üìû –ö–û–ù–¢–ê–ö–¢–ò

**–ü–∏—Ç–∞–Ω–Ω—è –ø–æ backend:** Backend team  
**–ü–∏—Ç–∞–Ω–Ω—è –ø–æ frontend:** Frontend team  
**–ü–∏—Ç–∞–Ω–Ω—è –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó:** Tech lead  

**Slack –∫–∞–Ω–∞–ª–∏:**
- `#calendar-v046` - –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
- `#bug-reports` - –∑–≤—ñ—Ç–∏ –ø—Ä–æ –±–∞–≥–∏
- `#dev-help` - —Ç–µ—Ö–Ω—ñ—á–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –î–û –¢–ï–°–¢–£–í–ê–ù–ù–Ø  
**–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫:** –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –Ω–∞ dev —Å–µ—Ä–≤–µ—Ä—ñ –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏  
**ETA production:** 2-3 –¥–Ω—ñ –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–ü—ñ–¥–≥–æ—Ç—É–≤–∞–≤:** Cascade AI  
**–î–∞—Ç–∞:** 23.12.2024  
**–í–µ—Ä—Å—ñ—è –∑–≤—ñ—Ç—É:** 1.0
