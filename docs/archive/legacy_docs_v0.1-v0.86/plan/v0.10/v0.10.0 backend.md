BACKEND — TECHNICAL SPEC v0.10.0
1. WebSocket Gateway (WS Server) — ОБОВ’ЯЗКОВО

Створити окремий застосунок: apps.realtime

1.1. Підтримувані канали:

chat:user:{id}

board:lesson:{id}

status:users

notifications:user:{id}

1.2. Додати WebSocket authentication:

токен = JWT (обмежена версія)

перевірка користувача кожні N хвилин

відключення при невалідному токені

1.3. Підтримка broadcast:

всі події в каналі lesson → WS розсилає до всіх підключених студентів/тьюторів

логувати тільки тип, user_id та розмір payload

2. Real-time Chat API + WS events
2.1. REST:

POST /api/chat/messages/

GET /api/chat/history/?lesson_id=&cursor=

2.2. Події WS:

chat.message.new

chat.message.edited

chat.message.deleted

2.3. Модель:
Message(id, lesson_id, author, text, edited_at, created_at)

3. Online Presence
3.1. Механіка:

Redis key presence:user:{id}

TTL 90 секунд

heartbeat кожні 30 сек

події:

user.online

user.offline

3.2. API:

GET /api/users/online-status/?ids=1,2,3

4. Realtime Collaborative Whiteboard
4.1. WS події:

board.patch

board.reset

board.cursor.move

board.snapshot.request

board.snapshot.send

4.2. Backend логіка:

отримує patch → пересилає всім іншим клієнтам

snapshot зберігається кожні 30s у PostgreSQL:

BoardSnapshot(id, lesson_id, data, saved_at)

5. Push Notifications (WS + email fallback)

якщо користувач онлайн → WS

якщо офлайн → email (через Jinja templates)

Події:

lesson.scheduled

lesson.rescheduled

chat.message

board.activity

tutor.accept

student.invited

6. Tests (обов’язково)

20+ WS тестів (pytest + channels testing)

presence tests

chat API tests

board snapshot tests