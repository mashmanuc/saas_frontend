Оновлено: 2025-02
Статус: стабільно, сумісно з фронтендом v0.3.0.

1. Аутентифікація та авторизація
1.1 POST /api/auth/register/

Створення self-learning студента.

Request
{
  "email": "user@example.com",
  "password": "string",
  "first_name": "string",
  "last_name": "string",
  "timezone": "Europe/Kyiv"
}

Response
{
  "access": "jwt-access-token",
  "user": {
    "id": 1,
    "email": "user@example.com",
    "role": "student",
    "is_self_learning": true,
    "timezone": "Europe/Kyiv",
    "first_name": "",
    "last_name": ""
  }
}


Логіка:

Студент створюється з is_self_learning = true.

Немає тьютора.

Використовується у відкритій реєстрації.

1.2 POST /api/auth/login/
Request
{ "email": "user@example.com", "password": "string" }

Response
{
  "access": "jwt-access-token",
  "user": { ... }
}

1.3 POST /api/auth/refresh/

Тільки через HttpOnly cookie refresh.

Request
(no body)

Response
{ "access": "new-access-token" }

1.4 POST /api/auth/logout/

Блокує refresh-токен + очищає cookie.

Response
204 No Content

1.5 GET /api/users/me/

Повертає профіль поточного користувача.

Response
{
  "id": 1,
  "email": "user@example.com",
  "role": "student",
  "timezone": "Europe/Kyiv",
  "is_self_learning": true,
  "first_name": "Ivan",
  "last_name": "Ivanov"
}

2. Інвайти
2.1 GET /api/auth/invite/validate/?token=XYZ
Response
{
  "email": "student@mail.com",
  "tutor_name": "Іван Петров",
  "student_exists": false,
  "status": "valid",
  "expires_at": "2025-06-01T12:00:00Z",
  "note": "Lesson plan attached"
}

2.2 POST /api/auth/invite/accept/

Створює студента (не self-learning) та прив’язує до тьютора.

Request
{
  "token": "string",
  "password": "string",
  "first_name": "string",
  "last_name": "string",
  "timezone": "Europe/Kyiv"
}

Response
{
  "access": "token",
  "user": {
    "role": "student",
    "is_self_learning": false,
    ...
  }
}

3. Публічні тьютори
3.1 GET /api/tutors/public-list/

Повертає список тьюторів із відкритими профілями.

Response
[
  {
    "id": 3,
    "full_name": "Олена Петрівна",
    "email": "tutor@example.com",
    "timezone": "Europe/Kyiv",
    "bio": "10 років досвіду…",
    "subjects": ["math", "physics"],
    "hourly_rate": "25.00",
    "country": "UA",
    "rating": "4.8"
  }
]

Примітки:

tutor_profile.is_public = True

Деякі поля можуть бути null.

4. Взаємодія студент ↔ тьютор
4.1 POST /api/student/request_tutor/

Студент надсилає запит тьютору.

Request
{
  "tutor_id": 123,
  "note": "Хотів би займатися алгеброю"
}

Response
{
  "id": 55,
  "status": "invited",
  "notes": "Хотів би займатися алгеброю",
  "student": { ... },
  "created_at": "2025-01-01T12:00:00Z"
}


Логіка:

Створюється TutorStudentRelation(status="invited").

Студенту встановлюється is_self_learning = false.

4.2 POST /api/tutor/accept_request/

Тьютор підтверджує запит студента.

Request
{ "relation_id": 55 }

Response
{
  "id": 55,
  "status": "active",
  "relationship_start": "2025-01-01T12:05:00Z",
  "student": { ... }
}


Логіка:

Перевірка прав.

Підтверджує запит.

Студент також отримує is_self_learning = false.

4.3 GET /api/tutor/students/

Список студентів тьютора з усіма зв’язками.

Response
[
  {
    "id": 55,
    "status": "invited",
    "notes": "Хочу почати уроки",
    "student": {
      "id": 10,
      "email": "student@mail.com",
      "first_name": "Іван",
      "last_name": "Іванов",
      "role": "student",
      "timezone": "Europe/Kyiv",
      "is_self_learning": false
    },
    "created_at": "2025-01-01T12:00:00Z",
    "updated_at": "2025-01-01T12:00:00Z"
  }
]

5. Модель даних (спрощено)
User
Поле	Тип	Опис
role	enum(student/tutor/admin/superadmin)	Роль у системі
is_self_learning	bool	Чи вільний студент
timezone	string	Часовий пояс
email	string	Унікальний email
first_name	string	Ім'я
last_name	string	Прізвище
TutorStudentRelation
Поле	Опис
tutor	User(role='tutor')
student	User(role='student')
status	invited / active / paused / archived
notes	текст студента або тьютора
invited_by	User
relationship_start	дата
created_at / updated_at	timestamps
6. Авторизація ролей
Роль	Право
student	надсилати запит тьютору, переглядати свій дашборд
tutor	приймати запити, переглядати студентів
admin	майбутній модуль адмінки
superadmin	повний контроль
7. Помилки (DRF стандарти)
401 Unauthorized
{ "detail": "Authentication credentials were not provided." }

403 Forbidden
{ "detail": "You do not have permission to perform this action." }

400 Bad Request
{ "detail": "Invalid token." }

8. Плани на v0.4.0

Повна адмін-панель.

Розширені профілі тьюторів.

Календар занять.

Домашні роботи.

Оплати та білінг.