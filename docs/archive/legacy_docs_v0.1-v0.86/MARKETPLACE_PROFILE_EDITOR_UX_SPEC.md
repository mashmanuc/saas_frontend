# Marketplace Tutor Profile Editor — UX/SPEC

## Контекст
Цей документ фіксує **цільову поведінку** сторінок редагування профілю тьютора (Marketplace), з урахуванням:

- розділення "мови як предмети" (subjects з `code` на кшталт `language_english`) та "мови викладання" (`teaching_languages`)
- вимоги **не показувати валідацію до явної дії користувача** (Save/Publish)
- відсутності/відключення legacy-флоу (зокрема доступність/календар, та будь-які посилання в legacy)
- стабільності при rate limiting (429 / `RATE_LIMITED`)

## Доменні сутності
- **Subjects** (`subjects`): список предметів, які тьютор викладає.
  - включає "мови як предмети" (наприклад `language_english`) — це предмети, що публікуються в маркетплейсі.
  - кожен subject має `tags` (subject specialty tags) і `custom_direction_text`.

- **Teaching languages** (`teaching_languages`): мови, якими тьютор викладає/спілкується з учнями.
  - це НЕ те саме, що subjects.
  - це окрема вкладка і окрема вимога для готовності профілю.

- **Catalog / Tag map**:
  - `subject_tag_map` (SSOT): визначає, які теги дозволені для конкретного предмета.
  - `catalog tags`: повний каталог доступних тегів.
  - UI показує лише дозволені теги для конкретного предмета.

## Правила UX

### 1) Валідація
- **Принцип:** UI не має "кричати" на користувача до першої явної спроби збереження.

- **Показ помилок дозволено тільки коли:**
  - користувач натиснув **"Зберегти"** (або **"Опублікувати"** якщо це окрема дія), або
  - бекенд повернув API validation errors на явну дію Save/Publish.

- **Валідація `teaching_languages`:**
  - перевіряється **лише поле `teaching_languages`**.
  - НЕ перевіряти `languages` (deprecated) і НЕ плутати це з "мови як предмети".

- **Валідація "мови як предмети":**
  - предмети типу `language_*` — частина `subjects` і проходять через загальну перевірку `subjects.length > 0`.
  - НЕ повинні впливати на правило `teaching_languagesRequired`.

### 2) Autosave
- **Ціль:** не втрачати дані при навігації/перезавантаженні.
- **Технічна поведінка:**
  - autosave зберігає **лише локальний draft** (localStorage).
  - autosave **не робить server calls** (щоб не ловити `RATE_LIMITED` і не створювати шум у Network).
  - серверне збереження — тільки через явний Save.

### 3) Tag UX
- Якщо `subject_tag_map` або каталог тегів не завантажено:
  - UI показує нейтральний стан (loading/empty), але **без помилкових попереджень**.
  - попередження "Теги не налаштовані" допустиме лише якщо `subject_tag_map` завантажено і реально немає конфігурації.

### 4) Rate limiting (429 / RATE_LIMITED)
- UI не має повторювати запити кожні 1-2 секунди.
- При отриманні 429:
  - UI не показує агресивні тости у циклі.
  - наступні повтори (якщо потрібні) робити з backoff, але пріоритет — уникнути фонових запитів.

### 5) Legacy / disabled domains
- Якщо домен (наприклад "Фінанси" чи "Legacy availability") відключений:
  - **не показувати кнопки**, що ведуть у legacy.
  - не викидати помилки через неактуальні запити.

## Очікуваний флоу користувача

1. Користувач заходить у редактор профілю.
2. Може редагувати дані без спливаючих помилок.
3. Додає предмети та теги.
4. Додає "мову викладання" в окремій вкладці.
5. Натискає **"Зберегти"**.
6. Лише після цього UI:
   - показує тости валідації (якщо потрібно)
   - підсвічує секції/поля з проблемами.

## Перевірки (QA)
- **Не має бути** тостів валідації при простому відкритті сторінки.
- **Не має бути** вимоги вибрати "мову" через `languagesRequired`.
- **Має бути** вимога `teaching_languagesRequired` при Save, якщо поле порожнє.
- **Не має бути** кнопки "Налаштувати доступність" у пустому стані, якщо вона веде в legacy.
- **Не має бути** спаму запитів в Network під час набору тексту.
